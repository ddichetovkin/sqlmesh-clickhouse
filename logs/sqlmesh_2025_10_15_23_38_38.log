2025-10-15 23:38:39,622 - MainThread - sqlmesh.core.config.connection - INFO - Creating new DuckDB adapter for in-memory database (connection.py:493)
2025-10-15 23:38:39,724 - MainThread - sqlmesh.core.config.connection - INFO - Creating new DuckDB adapter for data files: {'local.duckdb'} (connection.py:491)
2025-10-15 23:38:39,724 - MainThread - sqlmesh.core.console - WARNING - The duckdb engine is not recommended for storing SQLMesh state in production deployments. Please see https://sqlmesh.readthedocs.io/en/stable/guides/configuration/#state-connection for a list of recommended engines and more information. (console.py:2335)
2025-10-15 23:38:43,868 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage PhysicalLayerSchemaCreationStage (evaluator.py:123)
2025-10-15 23:38:43,869 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating schema 'sqlmesh__sqlmesh_example' (evaluator.py:1443)
2025-10-15 23:38:43,870 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 7ed1e07ab1e04a31b35eb93a3b32917d */ CREATE DATABASE IF NOT EXISTS "sqlmesh__sqlmesh_example" (base.py:2614)
2025-10-15 23:38:43,958 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage BackfillStage (evaluator.py:123)
2025-10-15 23:38:43,968 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Listing data objects in schema sqlmesh__sqlmesh_example (evaluator.py:1610)
2025-10-15 23:38:43,990 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sqlmesh_example"."seed_model": 804198623> (evaluator.py:711)
2025-10-15 23:38:43,991 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating table 'sqlmesh__sqlmesh_example.sqlmesh_example__seed_model__1675699986' (evaluator.py:2034)
2025-10-15 23:38:43,992 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 7ed1e07ab1e04a31b35eb93a3b32917d */ CREATE TABLE IF NOT EXISTS "sqlmesh__sqlmesh_example"."sqlmesh_example__seed_model__1675699986" ("id" Int32, "item_id" Int32, "event_date" DATE) ENGINE=MergeTree ORDER BY () (base.py:2614)
2025-10-15 23:38:44,054 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 7ed1e07ab1e04a31b35eb93a3b32917d */ DESCRIBE "sqlmesh__sqlmesh_example"."__temp_sqlmesh_example__seed_model__1675699986_4xwt09yn" (base.py:2614)
2025-10-15 23:38:44,068 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 7ed1e07ab1e04a31b35eb93a3b32917d */ CREATE TABLE IF NOT EXISTS "sqlmesh__sqlmesh_example"."__temp_sqlmesh_example__seed_model__1675699986_4xwt09yn" ("id" Int32, "item_id" Int32, "event_date" DATE) ENGINE=MergeTree ORDER BY () (base.py:2614)
2025-10-15 23:38:44,110 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 7ed1e07ab1e04a31b35eb93a3b32917d */ CREATE TABLE "sqlmesh__sqlmesh_example"."__temp_sqlmesh_example__seed_model__1675699986_oyougk9l" AS "sqlmesh__sqlmesh_example"."sqlmesh_example__seed_model__1675699986" (base.py:2614)
2025-10-15 23:38:44,125 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 7ed1e07ab1e04a31b35eb93a3b32917d */ DESCRIBE "sqlmesh__sqlmesh_example"."__temp_sqlmesh_example__seed_model__1675699986_4xwt09yn" (base.py:2614)
2025-10-15 23:38:44,137 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 7ed1e07ab1e04a31b35eb93a3b32917d */ INSERT INTO "sqlmesh__sqlmesh_example"."__temp_sqlmesh_example__seed_model__1675699986_oyougk9l" ("id", "item_id", "event_date") SELECT CAST("id" AS Int32) AS "id", CAST("item_id" AS Int32) AS "item_id", CAST("event_date" AS DATE) AS "event_date" FROM "sqlmesh__sqlmesh_example"."__temp_sqlmesh_example__seed_model__1675699986_4xwt09yn" (base.py:2614)
2025-10-15 23:38:44,155 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 7ed1e07ab1e04a31b35eb93a3b32917d */ DROP TABLE IF EXISTS "sqlmesh__sqlmesh_example"."__temp_sqlmesh_example__seed_model__1675699986_4xwt09yn" (base.py:2614)
2025-10-15 23:38:44,179 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 7ed1e07ab1e04a31b35eb93a3b32917d */ SELECT partition_key FROM system.tables WHERE database = 'sqlmesh__sqlmesh_example' AND name = 'sqlmesh_example__seed_model__1675699986' (base.py:2614)
2025-10-15 23:38:44,193 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 7ed1e07ab1e04a31b35eb93a3b32917d */ EXCHANGE TABLES "sqlmesh__sqlmesh_example"."sqlmesh_example__seed_model__1675699986" AND "sqlmesh__sqlmesh_example"."__temp_sqlmesh_example__seed_model__1675699986_oyougk9l" (base.py:2614)
2025-10-15 23:38:44,206 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 7ed1e07ab1e04a31b35eb93a3b32917d */ DROP TABLE IF EXISTS "sqlmesh__sqlmesh_example"."__temp_sqlmesh_example__seed_model__1675699986_oyougk9l" (base.py:2614)
2025-10-15 23:38:44,219 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-10-14 00:00:00, 2025-10-15 00:00:00) for snapshot SnapshotId<"sqlmesh_example"."seed_model": 804198623> (facade.py:637)
2025-10-15 23:38:44,219 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sqlmesh_example"."seed_model": 804198623> (interval.py:215)
2025-10-15 23:38:44,239 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating a physical table for snapshot SnapshotId<"sqlmesh_example"."incremental_model": 2863117570> (evaluator.py:870)
2025-10-15 23:38:44,248 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating table 'sqlmesh__sqlmesh_example.sqlmesh_example__incremental_model__3797213309' (evaluator.py:2034)
2025-10-15 23:38:44,249 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 7ed1e07ab1e04a31b35eb93a3b32917d */ CREATE TABLE IF NOT EXISTS "sqlmesh__sqlmesh_example"."sqlmesh_example__incremental_model__3797213309" ("id" Int32, "item_id" Int32, "event_date" DATE) ENGINE=MergeTree ORDER BY () PARTITION BY (toMonday("event_date")) (base.py:2614)
2025-10-15 23:38:44,264 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Dry running model 'sqlmesh_example.incremental_model' (evaluator.py:2056)
2025-10-15 23:38:44,265 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 7ed1e07ab1e04a31b35eb93a3b32917d */ SELECT "seed_model"."id" AS "id", "seed_model"."item_id" AS "item_id", "seed_model"."event_date" AS "event_date" FROM "sqlmesh__sqlmesh_example"."sqlmesh_example__seed_model__1675699986" AS "seed_model" WHERE ("seed_model"."event_date" <= toDate('1970-01-01') AND "seed_model"."event_date" >= toDate('1970-01-01')) AND FALSE LIMIT 0 (base.py:2614)
2025-10-15 23:38:44,282 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sqlmesh_example"."incremental_model": 2863117570> (evaluator.py:711)
2025-10-15 23:38:44,283 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting data for snapshot SnapshotId<"sqlmesh_example"."incremental_model": 2863117570> (evaluator.py:952)
2025-10-15 23:38:44,294 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2020-01-01 00:00:00, 2025-10-15 00:00:00) into sqlmesh__sqlmesh_example.sqlmesh_example__incremental_model__3797213309' (evaluator.py:984)
2025-10-15 23:38:44,295 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 7ed1e07ab1e04a31b35eb93a3b32917d */ CREATE TABLE sqlmesh__sqlmesh_example."__temp_sqlmesh_example__incremental_model__3797213309_fa6cz533" AS sqlmesh__sqlmesh_example.sqlmesh_example__incremental_model__3797213309 (base.py:2614)
2025-10-15 23:38:44,315 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 7ed1e07ab1e04a31b35eb93a3b32917d */ INSERT INTO "sqlmesh__sqlmesh_example"."__temp_sqlmesh_example__incremental_model__3797213309_fa6cz533" ("id", "item_id", "event_date") SELECT "id", "item_id", "event_date" FROM (SELECT "seed_model"."id" AS "id", "seed_model"."item_id" AS "item_id", "seed_model"."event_date" AS "event_date" FROM "sqlmesh__sqlmesh_example"."sqlmesh_example__seed_model__1675699986" AS "seed_model" WHERE "seed_model"."event_date" <= toDate('2025-10-14') AND "seed_model"."event_date" >= toDate('2020-01-01')) AS "_subquery" WHERE "event_date" BETWEEN CAST('2020-01-01' AS Nullable(DATE)) AND CAST('2025-10-14' AS Nullable(DATE)) (base.py:2614)
2025-10-15 23:38:44,339 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 7ed1e07ab1e04a31b35eb93a3b32917d */ SELECT partition_key FROM system.tables WHERE database = 'sqlmesh__sqlmesh_example' AND name = 'sqlmesh_example__incremental_model__3797213309' (base.py:2614)
2025-10-15 23:38:44,366 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 7ed1e07ab1e04a31b35eb93a3b32917d */ CREATE TABLE IF NOT EXISTS "sqlmesh__sqlmesh_example"."__temp__affected_partitions_73njg4hd" ENGINE=MergeTree ORDER BY () AS SELECT DISTINCT "partition_id" FROM (SELECT "_partition_id" AS "partition_id" FROM "sqlmesh__sqlmesh_example"."sqlmesh_example__incremental_model__3797213309" WHERE "event_date" BETWEEN CAST('2020-01-01' AS Nullable(DATE)) AND CAST('2025-10-14' AS Nullable(DATE)) UNION DISTINCT SELECT "_partition_id" AS "partition_id" FROM "sqlmesh__sqlmesh_example"."__temp_sqlmesh_example__incremental_model__3797213309_fa6cz533") AS "_affected_partitions" (base.py:2614)
2025-10-15 23:38:44,391 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 7ed1e07ab1e04a31b35eb93a3b32917d */ SELECT DISTINCT partition_id FROM sqlmesh__sqlmesh_example."__temp__affected_partitions_73njg4hd" (base.py:2614)
2025-10-15 23:38:44,406 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 7ed1e07ab1e04a31b35eb93a3b32917d */ INSERT INTO "sqlmesh__sqlmesh_example"."__temp_sqlmesh_example__incremental_model__3797213309_fa6cz533" SELECT "id", "item_id", "event_date" FROM "sqlmesh__sqlmesh_example"."sqlmesh_example__incremental_model__3797213309" WHERE NOT ("event_date" BETWEEN CAST('2020-01-01' AS Nullable(DATE)) AND CAST('2025-10-14' AS Nullable(DATE))) AND "_partition_id" IN (SELECT "partition_id" FROM "sqlmesh__sqlmesh_example"."__temp__affected_partitions_73njg4hd") (base.py:2614)
2025-10-15 23:38:44,424 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 7ed1e07ab1e04a31b35eb93a3b32917d */ DROP TABLE IF EXISTS "sqlmesh__sqlmesh_example"."__temp__affected_partitions_73njg4hd" (base.py:2614)
2025-10-15 23:38:44,445 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 7ed1e07ab1e04a31b35eb93a3b32917d */ SELECT DISTINCT _partition_id FROM sqlmesh__sqlmesh_example."__temp_sqlmesh_example__incremental_model__3797213309_fa6cz533" (base.py:2614)
2025-10-15 23:38:44,462 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 7ed1e07ab1e04a31b35eb93a3b32917d */ ALTER TABLE "sqlmesh__sqlmesh_example"."sqlmesh_example__incremental_model__3797213309" REPLACE PARTITION ID '20191230' FROM "sqlmesh__sqlmesh_example"."__temp_sqlmesh_example__incremental_model__3797213309_fa6cz533", REPLACE PARTITION ID '20200106' FROM "sqlmesh__sqlmesh_example"."__temp_sqlmesh_example__incremental_model__3797213309_fa6cz533" (base.py:2614)
2025-10-15 23:38:44,478 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 7ed1e07ab1e04a31b35eb93a3b32917d */ DROP TABLE IF EXISTS "sqlmesh__sqlmesh_example"."__temp_sqlmesh_example__incremental_model__3797213309_fa6cz533" (base.py:2614)
2025-10-15 23:38:44,489 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2020-01-01 00:00:00, 2025-10-15 00:00:00) for snapshot SnapshotId<"sqlmesh_example"."incremental_model": 2863117570> (facade.py:637)
2025-10-15 23:38:44,489 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sqlmesh_example"."incremental_model": 2863117570> (interval.py:215)
2025-10-15 23:38:44,513 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Evaluating snapshot SnapshotId<"sqlmesh_example"."full_model": 422697205> (evaluator.py:711)
2025-10-15 23:38:44,514 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting data for snapshot SnapshotId<"sqlmesh_example"."full_model": 422697205> (evaluator.py:952)
2025-10-15 23:38:44,526 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Inserting batch (2025-10-14 00:00:00, 2025-10-15 00:00:00) into sqlmesh__sqlmesh_example.sqlmesh_example__full_model__3479586690' (evaluator.py:984)
2025-10-15 23:38:44,529 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 7ed1e07ab1e04a31b35eb93a3b32917d */ CREATE TABLE IF NOT EXISTS "sqlmesh__sqlmesh_example"."sqlmesh_example__full_model__3479586690" ENGINE=MergeTree ORDER BY () AS SELECT CAST("item_id" AS Int32) AS "item_id", CAST("num_orders" AS Nullable(Int64)) AS "num_orders" FROM (SELECT "incremental_model"."item_id" AS "item_id", COUNT(DISTINCT "incremental_model"."id") AS "num_orders" FROM "sqlmesh__sqlmesh_example"."sqlmesh_example__incremental_model__3797213309" AS "incremental_model" GROUP BY "incremental_model"."item_id") AS "_subquery" (base.py:2614)
2025-10-15 23:38:44,561 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Auditing snapshot SnapshotId<"sqlmesh_example"."full_model": 422697205> (evaluator.py:603)
2025-10-15 23:38:44,561 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 7ed1e07ab1e04a31b35eb93a3b32917d */ DESCRIBE "sqlmesh__sqlmesh_example"."sqlmesh_example__full_model__3479586690" (base.py:2614)
2025-10-15 23:38:44,577 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 7ed1e07ab1e04a31b35eb93a3b32917d */ SELECT COUNT(*) FROM (SELECT * FROM "sqlmesh__sqlmesh_example"."sqlmesh_example__full_model__3479586690" AS "sqlmesh_example__full_model__3479586690" WHERE "item_id" < 0) AS "audit" (base.py:2614)
2025-10-15 23:38:44,604 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Adding interval (2025-10-14 00:00:00, 2025-10-15 00:00:00) for snapshot SnapshotId<"sqlmesh_example"."full_model": 422697205> (facade.py:637)
2025-10-15 23:38:44,604 - MainThread - sqlmesh.core.state_sync.db.interval - INFO - Pushing intervals for snapshot SnapshotId<"sqlmesh_example"."full_model": 422697205> (interval.py:215)
2025-10-15 23:38:44,632 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage EnvironmentRecordUpdateStage (evaluator.py:123)
2025-10-15 23:38:44,632 - MainThread - sqlmesh.core.state_sync.db.facade - INFO - Promoting environment 'prod' (facade.py:167)
2025-10-15 23:38:44,661 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage UnpauseStage (evaluator.py:123)
2025-10-15 23:38:44,672 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage VirtualLayerUpdateStage (evaluator.py:123)
2025-10-15 23:38:44,677 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Creating schema 'sqlmesh_example' (evaluator.py:1443)
2025-10-15 23:38:44,678 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 7ed1e07ab1e04a31b35eb93a3b32917d */ CREATE DATABASE IF NOT EXISTS "sqlmesh_example" (base.py:2614)
2025-10-15 23:38:44,697 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Listing data objects in schema sqlmesh_example (evaluator.py:1610)
2025-10-15 23:38:44,715 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Updating view 'sqlmesh_example.seed_model' to point at table 'sqlmesh__sqlmesh_example.sqlmesh_example__seed_model__1675699986' (evaluator.py:1980)
2025-10-15 23:38:44,716 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 7ed1e07ab1e04a31b35eb93a3b32917d */ CREATE OR REPLACE VIEW "sqlmesh_example"."seed_model" AS SELECT * FROM "sqlmesh__sqlmesh_example"."sqlmesh_example__seed_model__1675699986" (base.py:2614)
2025-10-15 23:38:44,736 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Updating view 'sqlmesh_example.incremental_model' to point at table 'sqlmesh__sqlmesh_example.sqlmesh_example__incremental_model__3797213309' (evaluator.py:1980)
2025-10-15 23:38:44,737 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 7ed1e07ab1e04a31b35eb93a3b32917d */ CREATE OR REPLACE VIEW "sqlmesh_example"."incremental_model" AS SELECT * FROM "sqlmesh__sqlmesh_example"."sqlmesh_example__incremental_model__3797213309" (base.py:2614)
2025-10-15 23:38:44,756 - MainThread - sqlmesh.core.snapshot.evaluator - INFO - Updating view 'sqlmesh_example.full_model' to point at table 'sqlmesh__sqlmesh_example.sqlmesh_example__full_model__3479586690' (evaluator.py:1980)
2025-10-15 23:38:44,758 - MainThread - sqlmesh.core.engine_adapter.base - INFO - Executing SQL: /* SQLMESH_PLAN: 7ed1e07ab1e04a31b35eb93a3b32917d */ CREATE OR REPLACE VIEW "sqlmesh_example"."full_model" AS SELECT * FROM "sqlmesh__sqlmesh_example"."sqlmesh_example__full_model__3479586690" (base.py:2614)
2025-10-15 23:38:44,783 - MainThread - sqlmesh.core.plan.evaluator - INFO - Evaluating plan stage FinalizeEnvironmentStage (evaluator.py:123)
2025-10-15 23:38:44,783 - MainThread - sqlmesh.core.state_sync.db.environment - INFO - Finalizing environment 'prod' (environment.py:141)
2025-10-15 23:38:44,813 - MainThread - root - INFO - Shutting down the event dispatcher (dispatcher.py:159)
